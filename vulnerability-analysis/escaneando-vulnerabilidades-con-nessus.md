---
description: >-
  En esta pr치ctica veremos como hacer scanning the vulnerabilidades usando
  Nessus Vulnerability Scanner.
---

# Escaneando Vulnerabilidades con Nessus

## Nessus

![](../.gitbook/assets/nessus.png)

{% hint style="success" %}
**Wikipedia:** 游녤 [Link](https://es.wikipedia.org/wiki/Nessus).  
**Nessus** es un programa de **escaneo de vulnerabilidades** en **diversos sistemas operativos**. Consiste en un demonio o diablo\(`daemon`\), **`nessusd`**, que realiza el escaneo en el sistema objetivo, y **`nessus`**, el cliente \(basado en `consola o gr치fico`\) que muestra el avance e informa sobre el estado de los escaneos.
{% endhint %}

### Instalando Nessus \(Essentials\)

![](../.gitbook/assets/nessus-essentials-logo-1-.svg)

Para poder instalar **`Nessus`** debemos crearnos una cuenta sin costo que nos dar치 acceso a **`Nessus Essentials,`** una versi칩n limitada pero a칰n muy poderosa de **`Nessus`** que incluye suficientes escaneos para poder realizar esta pr치ctica.

{% hint style="success" %}
**Web para registrarnos en el siguiente**  游녤 [**Li**](https://www.tenable.com/products/nessus/nessus-essentials)**nk**.   
La creaci칩n de la cuenta es un proceso trivial como en cualquier web y no lo cubriremos como parte de la pr치ctica.
{% endhint %}

Una vez estamos registrados y tenemos nuestra cuenta de `Nessus Essentials` recibiremos por mail nuestra `clave de activaci칩n` para poder descargar e instalar `Nessus`.

{% hint style="danger" %}
**Nessus** es un software que **consume su buena cuota de recursos**, de ser posible es recomendable tener una **VM dedicada para su uso**. De esta manera podemos dejar el scanning corriendo en la **VM de Nessus** y continuar cualquier otra tarea en nuestra **VM regular de trabajo** sin que afecte su fluidez y sin correr el riesgo de que otras tareas afecten los procesos de scanning de Nessus.
{% endhint %}

La p치gina de descarga de Nessus ofrece diversas versiones seg칰n nuestro sistema operativo. Para esta pr치ctica usaremos una **`VM con Kali Linux 2020.4`**. 

{% hint style="success" %}
**P치gina de descarga de Nessus:** 游녤 [**Link**](https://www.tenable.com/downloads/nessus?loginAttempted=true).
{% endhint %}

En este caso descargar칠 la versi칩n indicada para distribuciones basadas en **`Debian 64 bits`**.

![](../.gitbook/assets/image%20%2812%29.png)

La web nos pide aceptar la Licencia y comienza la descarga. Veamos como instalamos el paquete **`.deb`** descargado usando el comando **`dpkg -i {NombreDelArchivo.deb}`**.

En nuestra terminal nos dirigimos a la carpeta de descargas \(o el directorio donde hayas descargado **Nessus**\) y ejecutamos el comando:

![](../.gitbook/assets/image%20%2896%29.png)

Una vez instalado necesitamos inicializar el servicio que ejecutar치 el **`daemon`** llamado **`nessusd`**. Para iniciar el servicio usamos el comando **`/bin/systemctl start nessusd.service`**.

![](../.gitbook/assets/image%20%2835%29.png)

{% hint style="warning" %}
Es necesario ejecutar el comando con privilegios usando **`sudo`**.
{% endhint %}

Con esto ya tenemos Nessus listo para ser iniciado, no obstante el primer inicio involucra configuraciones adicionales antes de poder usar Nessus. 

### Iniciando Nessus

Para Iniciar Nessus, abrimos la siguiente URL [`https://kali:8834/`](https://kali:8834/) como menciona el mensaje que recibimos luego de instalar Nessus. 

![](../.gitbook/assets/image%20%285%29.png)

Al hacerlo, recibiremos una advertencia sobre el certificado inv치lido. Hacemos `click` en el bot칩n **`advanced`** y en el `link` del final **`Procced to kali (unsafe)`**.  Deber칤amos ahora ver esta pantalla:

![](../.gitbook/assets/image%20%2820%29.png)

Con la opci칩n Nessus Essentials seleccionada hacemos `click` en **`Continue`**. En el siguiente paso nos pedir치 registrarnos, dado que ya tenemos nuestra cuenta y clave de activaci칩n, hacemos `click` en **`skip`**. En el siguiente paso ingresaremos nuestro c칩digo de activaci칩n y daremos `click` en **`continue`**.

![](../.gitbook/assets/image%20%2893%29.png)

Nessus nos pedir치 crear una cuenta de `administrador` para usar la herramienta, ingresamos el `user y password` que deseemos y hacemos `click` en **`Submit`**.

A continuaci칩n Nessus comenzara a descargar e inicializar sus plugins. 

{% hint style="danger" %}
_Si en este punto recibes un error de que la descarga de plugins fall칩, visita esta_ 游녤 [_**secci칩n**_](escaneando-vulnerabilidades-con-nessus.md#troubleshooting-nessus-descarga-fallida) _al final de este escrito llamada_ [_**Troubleshooting Nessus**_](escaneando-vulnerabilidades-con-nessus.md#troubleshooting-nessus-descarga-fallida)_. En caso contrario_ sigue leyendo.
{% endhint %}

![](../.gitbook/assets/image%20%2829%29.png)

\_\_

Si todo ha salido bien, veremos la siguiente pantalla donde nos pedir치 que ingresemos el usuario y contrase침a que especificamos antes para la cuenta administrador.

![](../.gitbook/assets/image%20%2846%29.png)





Una vez iniciada la sesi칩n en **`nessus`**, veremos la siguiente pantalla y tendremos todo listo para comenzar nuestra pr치ctica.

![](../.gitbook/assets/image%20%2867%29.png)

### Nuestro primer scan con Nessus \(`Discovery & Vulnerability Scans`\)

Ahora que tenemos **Nessus** instalado y listo, veremos a continuaci칩n como podemos **`realizar un scan de vulnerabilidades`**, que **`informaci칩n obtenemos`** del mismo y como **`nessus`** presenta los resultados.

Para est치 pr치ctica voy usar como objetivo las **`VMs`** de mi [Laboratorio local para pr치cticas de **`Active Directory`**](../scanning/running-scans-with-nmap.md#intro-distintos-tipos-de-scans-con-nmap) y veremos las vulnerabilidades que logra detectar **`Nessus`**.

**Objetivos a escanear:**

<table>
  <thead>
    <tr>
      <th style="text-align:left">Equipo</th>
      <th style="text-align:left">IP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">
        <p></p>
        <p>DC: Controlador de Dominio</p>
      </td>
      <td style="text-align:left">
        <p></p>
        <p>192.168.31.131</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">Client1: Windows 10 Enterprise</td>
      <td style="text-align:left">192.168.31.132</td>
    </tr>
    <tr>
      <td style="text-align:left">Client2: Windows 10 Pro</td>
      <td style="text-align:left">192.168.31.133</td>
    </tr>
  </tbody>
</table>

Ingresamos las direcciones **`IP`** en el campo **`targets`** de la ventana de bienvenida a Nessus y hacemos **`click`** en el bot칩n **`submit`**.

![](../.gitbook/assets/image%20%28115%29.png)

Al darle **`submit`** Nessus comenzara a realizar un proceso de **`host discovery`** para ubicar hosts adicionales que puedan existir dentro de los targets especificados. Al completarse, seleccionamos los que en efecto vayamos a escanear.

{% hint style="warning" %}
Tengamos presente que **`Nessus Essentials`** nos limita en la cantidad de **`hosts`** que podemos escanear. Actualmente ese limite es de **`16 hosts.`**
{% endhint %}

![](../.gitbook/assets/image%20%2843%29.png)

En este punto basta con dar **`click`** en **`Run Scan`** y **`Nessus`** autom치ticamente realizar치 un escaneo b치sico de cada objetivo para comenzar a conocer un poco m치s sobre ellos.

Para ver nuestro **`scan`** en marcha podemos ir a la **`tab`** llamada **`History`**:

![](../.gitbook/assets/image%20%2872%29.png)

Luego de un momento veremos que las **`tabs`** llamadas **`Hosts`** y **`Vulnerabilities`** comenzar치n a registrar resultados:

![](../.gitbook/assets/image%20%28139%29.png)

Dejaremos correr el scan hasta que se complete del todo, sin embargo es bueno saber que podemos ir revisando en tiempo real las detecciones registradas en las correspondientes **`tabs`** de la pantalla **`My Basic Network Scan`**.

Luego de unos minutos obtenemos el resultado del **`scan b치sico`**:

![](../.gitbook/assets/image%20%28114%29.png)

Como podemos ver Nessus clasifica las vulnerabilidades encontradas en base a distintos niveles de severidad y su puntaje **`CVSS (Common Vulnerability Scoring System)`** especificado por la **`National Vunlerability Database en su versi칩n CVSSv2`** \(anteriormente estaba m치s alineado a **`CVSSv1`**\). 

{% hint style="success" %}
Para conocer m치s sobre como se clasifican las severidades en **CVSSv2** y sus respectivos **valores**, visita el siguiente 游녤 [**link**.](https://nvd.nist.gov/vuln-metrics/cvss)
{% endhint %}

| CVSS Score | Severidad en Nessus |
| :--- | :--- |
| Entre 1.0 y 3.9 | Low/Info |
| Entre 4.0 y 6.0 | Medium |
| Entre 7.0 a 9.9 | High |
| 10.0 | Critical |

Veamos en este caso en detalle la vulnerabilidad de severidad **`Medium`** detectada: **`SBM Signing not required`**. 

![](../.gitbook/assets/image%20%2823%29.png)

Para ver el detalle de cualquier resultado, basta con hacerle **`click`** y Nessus nos mostrar치 la siguiente pantalla con todo el detalle disponible:

![](../.gitbook/assets/image%20%28102%29.png)

De cada vulnerabilidad obtendremos un detalle similar, en este caso la siguiente informaci칩n es provista:

* **Detalle de la Vulnerabilidad:**  
  * **Severidad de la vulnerabilidad**: **`MEDIUM`**.  
  * **Descripci칩n:** Obtenemos una descripci칩n del posible impacto de la vulnerabilidad. En este caso nos indica que la **firma de comunicaciones con el servidor** **SMB**, **no es requerida**. Lo cual puede permitir a un eventual atacante llevar a cabo ataques del tipo **`MIM (Man in the Middle)`**. 
  * **Soluci칩n:** Parte del detalle ofrecido por Nessus para cada vulnerabilidad incluye posibles soluciones para mitigar el riesgo de cada vulnerabilidad detectada. En este caso la soluci칩n es activar el requisito de que toda comunicaci칩n deba estar firmada **`(Digitally Sign Communications)`**.  
  * **Art칤culos relacionados:** Como parte del informe de detalle Nessus tambi칠n suele incluir links a diversos art칤culos donde se explica la tecnolog칤a afectada \(por ejemplo SMB\) y recursos adicionales que puede incluir otros art칤culos donde se vea en detalle la vulnerabilidad. 
  * **Listado de Puertos y Hosts Afectados:** Incluye el detalle de los puertos afectados y la lista de hosts donde se detect칩 la misma vulnerabilidad \(esta cantidad se corresponde al valor indicado en la columna **`Count`** en la lista de vulnerabilidades de la pantalla anterior\). En este caso vemos que solo dos de los tres equipos del lab est치n afectados por esta vulnerabilidad. 
  * **Detalles del plugin \(Plugin Details\)**: Informaci칩n b치sica y de referencia sobre cual plugin fue utilizado para realizar la detecci칩n. 
  * **Informaci칩n de Riesgo \(Risk Information\):** Detalle del los factores de riesgo y los diferentes puntajes CVSS que aplican para esta vulnerabilidad. 
  * **Informaci칩n de la Vulnerabilidad:** Esta secci칩n nos muestra un detalle adicional sobre la vulnerabilidad y la fecha en que fue publicada originalmente.

No es parte de esta pr치ctica el proceso de como solucionar la vulnerabilidad, nos centraremos 칰nicamente en el escaneo de las mismas y como son reportadas por Nessus.

{% hint style="info" %}
El laboratorio tiene varias vulnerabilidades y no es la intenci칩n remediarlas, dado que la idea es usarlo para practicar los distintos vectores de ataque. Sin embargo si te interesa leer como solucionar esta vulnerabilidad en particular, te recomiendo el siguiente post en espa침ol del blog de **0xsecure** en el siguiente 游녤 [**link**](https://0xsecure.blogspot.com/2019/10/smb-signing-not-required-firma-smb-no.html?m=1).
{% endhint %}

Hasta ac치 vimos como podemos realizar un scan b치sico en una instalaci칩n limpia de Nessus y como ver el detalle de las vulnerabilidades detectadas. No obstante no es la 칰nica forma de hacer escaneos dado que normalmente luego del primer scan realizado, Nessus no vuelve a mostrar la pantalla de Bienvenida para iniciar un scan autom치tico r치pido como vimos en este ejemplo. Por este motivo en la siguiente secci칩n veremos como podemos iniciar un scan a demanda en Nessus Essentials y los pasos necesarios para hacerlo.

### Realizando `Scans On Demand` con Nessus \(`Zerologon Vuln Detection`\)

Una vez tenemos al menos un escaneo realizado en Nessus, al abrir el programa veremos que ya no aparece la pantalla de bienvenida para dejarnos ingresar los **`targets`** y realizar un **`scan b치sico`** autom치tico. Para iniciar un nuevo escaneo debemos hacer `click` en el bot칩n **`New Scan`**.

![](../.gitbook/assets/image%20%2821%29.png)

Luego de hacer **`click`** en **`New Scan`** Nessus nos muestra la siguiente pantalla donde aparecen listados los tipos de escaneos disponibles, incluyendo algunos a los cuales no vamos a tener acceso con Nessus Essentials.

![](../.gitbook/assets/image%20%28110%29.png)

Los primeros dos escaneos que aparecen listados \(**`Host Discovery`** y **`Basic Network Scan`**\) son los que fueron ejecutados por Nessus cuando cargamos nuestros objetivos en la pantalla de bienvenida.  Entre los escaneos disponibles se encuentra uno para detectar si nuestro objetivo es vulnerable a **`Zerologon`**, una vulnerabilidad que sigue impactado a equipos que no cuentan con los parches necesarios. Veamos si alguna de nuestras **`VMs`** del lab es vulnerable, incluso en caso de no ser vulnerables veremos como es el proceso para iniciar un escaneo manualmente en Nessus \(proceso que aplica a cualquier scan con mayor o menor configuraciones requeridas seg칰n el tipo de escaneo\). 

![](../.gitbook/assets/image%20%28123%29.png)

Para Iniciar un scan primero debemos configurarlo, comenzamos por hacer **`click`** en el scan llamado **`Zerologon Remote Scan`** y veremos la siguiente pantalla.

![](../.gitbook/assets/image%20%2874%29.png)

En esta pantalla debemos indicar un Nombre para el scan, Objetivos a escanear. Nessus es una herramienta ENORME y no es posible cubrir en esta pr치ctica todas las posibles configuraciones para este o cualquier otro scan.  Pero es importante saber que nos ofrece opciones para configurar el scan a nuestro gusto y necesidad. Entre estas opciones adicionales se encuentran ajustes como configuraciones de Ping y tipos de Ping a realizar, rango de puertos, enumeradores de puertos a usar e incluso opciones avanzadas como detener las operaciones si el host deja de responder durante el scan.

Una parte importante que debemos comprender sobre Nessus, es que todas sus funcionalidades son provistas por plugins y familias de plugins. Estos plugins son usados en los diferentes escaneos y aportan pruebas espec칤ficas que Nessus llevar치 a cabo. Podemos ver la lista de plugins que se usar치n durante un scan en la **`tab`** llamada **`Plugins`**. En Este caso podemos ver que el scan actual solamente hace uso de un plugin para testear **`Zerologon`**.

![](../.gitbook/assets/image%20%2861%29.png)

Si hacemos **`click`** sobre el nombre del plugin \(columna **`Plugin Name`**\) podemos ver un detalle o resumen sobre el plugin y la vulnerabilidad que testea.

![](../.gitbook/assets/image%20%2819%29.png)

El detalle es similar al que vimos durante el primer scan e incluye todo el detalle disponible sobre la vulnerabilidad. Una vez que estemos listos con los ajustes para nuestro scan, Indicamos el nombre para el mismo y los IP objetivos:

![](../.gitbook/assets/image%20%2847%29.png)

En este punto podemos guardar nuestro scan para ejecutarlo en otro momento o bien haciendo **`click`** en el bot칩n de la flecha abajo que tiene el bot칩n llamado **`Save`**, podemos elegir ejecutarlo ahora mismo haciendo **`click`** en **`Launch`**:

![](../.gitbook/assets/image%20%2831%29.png)

{% hint style="info" %}
Los **`scans`** guardados aparecer치n listados en debajo de **`My Scans`** junto con los otros escaneos que hayamos realizado o guardado anteriormente.
{% endhint %}

Si no guardaste el scan podes ejecutarlo haciendo **`click`** en el bot칩n de **`play`** que se muestra para este scan en la lista de escaneos \(**`My Scans`**\) como se muestra en la siguiente imagen.

![](../.gitbook/assets/image%20%2887%29.png)

De ac치 en adelante ocurre lo mismo que vimos durante el primer escaneo b치sico, Nessus realizara los testeos necesarios usando el **`Plugin`** configurado para el **`scan`** y nos devolver치 los resultados de las vulnerabilidades encontradas en caso de estar presentes en los objetivos escaneados. Veamos que resultados nos ofrece:

![](../.gitbook/assets/image%20%2868%29.png)

![](../.gitbook/assets/image%20%28131%29.png)

Como podemos observar el Nessus determin칩 en **`5 minutos`** que el **`Controlador de Dominio (DC)`** de nuestro lab es vulnerable al ataque **`Zerologon`**. Si hacemos **`click`** en la vulnerabilidad podemos darnos una idea de la potencia de **`Nessus`**.

![](../.gitbook/assets/image%20%28136%29.png)

Con tan solo **`23`** intentos pudo comprometer la seguridad del **`DC`**y verificar que en efecto es vulnerable al exploit **`Zerologon`**. Incluso vemos el detalle de la **`request`** y **`response`** enviadas por **`Nessus`**. 

Hasta ac치 llegamos con esta pr치ctica de scanning de vulnerabilidades con **Nessus**. Vimos como Instalar Nessus y realizar su configuraci칩n inicial, hasta su uso b치sico para realizar un scan inicial autom치tico \(**`Discovery`** y **`Network Basic Scan`**\). Finalmente realizamos un scan manual a demanda para comprobar si nuestro laboratorio era vulnerable al exploit **`Zerologon`** que afecta a los **`Controladores de Dominio`**. Con dicho scan comprobamos que en efecto nuestro **`DC`** es vulnerable. 

Adjunto a est치 pr치ctica el reporte generado por Nessus para el scan de ZeroLogon.

{% file src="../.gitbook/assets/zerologon-practica-utn\_ntyv40.pdf" caption="Reporte Generado por Nessus\(PDF\)." %}

{% hint style="info" %}
**Nessus** cuenta con muchas opciones que no podemos llegar a cubrir en esta pr치ctica, no obstante es bueno conocer que dispone de herramientas para crear nuestras propios **`templates`** de **`Policies`** para determinar las acciones que se llevan a cabo en cada tipo de **`scan`**. Tambi칠n incluye funcionalidades para generaci칩n de reportes, y reglas\(**`rules`**\) customizadas para el funcionamiento de los **`plugins`**. Todo esto sin tener en cuenta las dem치s funcionalidades y **`scans`** que se habilitan con la versi칩n paga. 

Ciertamente es una herramienta muy interesante y que me interesa comprender en mayor profundidad. Quiz치s dedique un escrito en particular profundizando en su uso en alg칰n momento. Por ahora quiz치 realice alguna que otra actualizaci칩n a esta misma pr치ctica.
{% endhint %}



### Troubleshooting Nessus

 Si durante el proceso de instalaci칩n y primer inicio recib칤s un error de descarga o alg칰n otro error que impide que Nessus termine de configurarse, podes probar las siguientes soluciones que pueden puede serte 칰tiles para remediar el problema. 

En mi caso, fue necesaria la soluci칩n numero dos para solucionarlo, los problemas que tuve al instalar **Nessus**.

#### Soluci칩n N칰mero 1:

Si durante la configuraci칩n inicial de Nessus recib칤s el error **`Download Failed (Descarga Fallida)`**  Intenta con la siguiente soluci칩n.

{% hint style="danger" %}
**NOTA:** Encaso de recibir un error de que la descarga a fallado. Podemos ejecutar el siguiente comando para solucionarlo **`sudo /opt/nessus/sbin/nessuscli update`**. 

![](../.gitbook/assets/image%20%2856%29.png) 
{% endhint %}

Una vez que ejecutamos ese comando, veremos el siguiente resultado en consola.

![](../.gitbook/assets/image%20%2895%29.png)

En algunos casos con esto ya podremos retomar la configuraci칩n de Nessus.

#### Soluci칩n N칰mero 2:

En caso de que el error persista luego de intentar la soluci칩n 1 o recibamos alg칰n error diferente que igualmente impide la correcta inicializaci칩n de Nessus. Podemos probar los siguientes comandos que resetearan por completo Nessus:

{% hint style="danger" %}
**Si el error persiste:** Podemos usar los siguientes comandos en orden para resetear Nessus por completo. M치s informaci칩n en el siguiente 游녤 [**link**](https://tenable.force.com/s/article/Nessus-feed-reset-to-fix-plugin-issues-or-error?r=7&ui-knowledge-aloha-components-aura-components-knowledgeone.ArticleActions.handleEditPublished=1&ui-force-components-controllers-recordGlobalValueProvider.RecordGvp.getRecord=1).

1. **\# service nessusd stop**
2. **\# /opt/nessus/sbin/nessuscli fix --reset**
3. **\# /opt/nessus/sbin/nessuscli fetch --register ACTIVATIONCODE**
4. **\# /opt/nessus/sbin/nessusd -R**
5. **\# service nessusd start**
{% endhint %}

Espero que te sea de ayuda.

{% hint style="info" %}
Estas pr치cticas est치n sujetas a modificaciones y correcciones, la versi칩n m치s actualizada disponible se encuentra online en [el siguiente link](https://tzero86.gitbook.io/tzero86/).
{% endhint %}

